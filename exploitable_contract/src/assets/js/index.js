import {initNEAR, login, logout, get_user, deposit, withdraw, get_all_users} from './blockchain'

async function flow(){
  let users = await get_all_users()

  $('#users').html('')
  for (var i = 0; i < users.length; i++) {
    $('#users').append(`<li>${users[i].name} - ${users[i].balance} N</li>`);
  }

  if (!window.walletAccount.accountId){
    $("#logged-out").show()
  }else{
    $("#logged-in").show()
    window.user = await get_user(window.walletAccount.accountId)
    $('#account').html(window.walletAccount.accountId)
    $('#user-balance').html(user.balance)
  }
}

window.onload = function(){
  window.nearInitPromise = initNEAR()
  .then(flow)
  .catch(console.error)
}

window.login = login
window.logout = logout
window.deposit = deposit

window.withdraw = async function(amount){
  console.log("Withdrawing from contract, please wait")
  await withdraw(amount);
  location.reload();
}
